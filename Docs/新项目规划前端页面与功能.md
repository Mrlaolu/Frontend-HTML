# iCalligraphy 新项目前端页面与功能说明文档

## 项目概述

iCalligraphy 新项目是一个专注于书法作品展示、单字收藏与字集管理的垂直平台。相比参考项目（iCalligraphy-reference），新项目功能更加聚焦，仅实现核心的产品需求，不包含拓展功能。

**核心定位**：作品展示 + 单字收藏 + 分类检索 + 创作提交

---

## 一、前端页面列表

项目共包含 **8个** 前端页面（HTML模板），分布在 `templates/` 目录下：

### 1. **index.html** - 首页/作品列表页
- 平台主入口页面
- 展示作品列表（热门推荐、最新上传、风格分类）
- 提供全局检索入口
- 导航栏包含：首页、检索、上传作品、个人中心、登录/注册

### 2. **login.html** - 登录页面
- 用户登录界面
- 支持用户名和密码登录
- 提供注册入口链接

### 3. **register.html** - 注册页面
- 新用户注册界面
- 支持设置用户名、密码
- 可上传自定义头像（可选）
- 提供登录入口链接

### 4. **work_detail.html** - 作品详情页（核心页面）
- 展示完整书法作品
- **自动分格功能**：系统按汉字排列方向自动分割格子，每格对应1个汉字
- **单字hover弹窗**：鼠标移动到格子上时显示单字详细信息（切片、作者、风格、所属作品、收藏按钮）
- **作品缩放/拖拽**：支持鼠标滚轮缩放、拖拽移动超屏作品
- 显示作品基础信息（名称、作者、风格、总字数、简介）
- 支持收藏单字到字集

### 5. **work_upload.html** - 作品上传/提交页
- 用户上传书法作品
- **图片上传**：支持单张/批量上传（最多5张），显示上传进度
- **格子调整**：系统自动分格后，用户可手动调整格子边界
- **信息录入**：填写作品信息（名称、作者、风格、简介）和单字信息
- **草稿保存**：支持保存草稿（7天内有效）
- **提交审核**：提交后进入待审核状态

### 6. **search.html** - 检索/搜索页
- 全局关键词检索（作者/作品名称/风格）
- 多维度筛选（风格、作者、作品来源）
- 结果展示切换（列表模式/网格模式）
- 支持作品和单字两种检索类型

### 7. **my_collections.html** - 我的字集页
- 查看所有创建的字集
- 字集内单字列表展示
- 字集创建/编辑/删除功能
- 字集内单字筛选（按作者、风格、作品来源）
- 单字移除/移动到其他字集

### 8. **profile.html** - 个人中心页
- 账号信息展示（头像、用户名、绑定手机、权限标识）
- **我的作品**：按状态分类展示（待审核/通过/驳回），查看审核进度
- **我的字集**：显示所有创建的字集及单字数量
- **草稿箱**：显示7天内未提交的草稿，支持继续编辑或删除
- **互动数据**：收到的赞、收藏记录、浏览历史
- **系统设置**：修改密码、绑定手机、隐私权限、缓存清理、意见反馈

---

## 二、主要功能模块

### 1. 用户认证系统 👤

#### 功能点
- **注册功能**：
  - 用户名、密码注册
  - 可选上传头像
  - 用户名唯一性校验
  - 密码强度要求
  
- **登录功能**：
  - 用户名密码登录
  - Session管理
  - 记住登录状态（可选）
  
- **退出登录**：
  - 清除Session信息
  - 返回首页

#### 权限说明
- **游客**：仅可浏览作品列表、查看作品详情、进行检索，无法收藏和上传
- **注册用户**：解锁收藏、上传、管理全功能

---

### 2. 作品展示与交互模块 🖼️

#### 功能点

- **作品列表展示**：
  - 按"热门推荐（点赞量）"、"最新上传（时间）"、"风格分类"展示
  - 网格/列表两种展示模式切换
  - 单页展示20条作品
  - Hover显示作品名称和作者
  - 点击进入作品详情页

- **作品自动分格**：
  - 系统按汉字排列方向（横向/纵向）自动分割格子
  - 每格对应1个汉字
  - 格子边界为浅灰色（透明度50%）
  - 单个格子最小200×200px
  - 自动分格准确率要求≥85%

- **单字hover弹窗**：
  - 鼠标移动到格子上时居中显示弹窗
  - 弹窗内容包含：
    - 单字高清切片（放大2倍）
    - 作者姓名
    - 风格（楷书/行书/草书/隶书/篆书）
    - 所属作品名称
    - 收藏按钮
  - 弹窗显示延迟≤300ms，鼠标离开后100ms消失
  - 弹窗尺寸固定400×300px，不遮挡当前格子

- **作品缩放/拖拽**：
  - 鼠标滚轮控制缩放
  - 放大上限：单字占屏幕50%
  - 缩小下限：整幅作品完整显示
  - 拖拽可移动超屏作品
  - 缩放比例范围：0.5倍（缩小）- 3倍（放大）
  - 缩放和拖拽无卡顿

- **作品基础信息**：
  - 作品名称（加粗）
  - 作者
  - 风格
  - 总字数
  - 简介（限200字，超出显示"..."，hover展开）

---

### 3. 单字收藏与字集管理模块 📚

#### 功能点

- **单字收藏触发**：
  - 点击弹窗"收藏"按钮
  - 默认添加至"我的收藏"字集
  - 支持选择已有字集或新建字集
  - 新建字集需填写名称（必填，限20字）和简介（可选，限100字）
  - 收藏成功后显示Toast提示（"已添加至XX字集"，持续2秒）
  - 单个单字可收藏至多个字集

- **字集创建/编辑**：
  - 新建字集：填写名称（必填，限20字）+ 简介（可选，限100字）
  - 编辑字集：修改名称、简介
  - 删除字集：需二次确认（"删除后单字将移除，是否确认？"）
  - 单个用户可创建无限字集，字集名称不可重复

- **字集分类筛选**：
  - 支持按"作者（模糊匹配）"筛选
  - 支持按"风格（下拉选择：楷书/行书/草书/隶书/篆书）"筛选
  - 支持按"作品来源（系统收录/用户上传）"筛选
  - 筛选条件实时生效，多条件叠加筛选（"且"关系）
  - 无匹配结果时显示"暂无结果，推荐热门单字"

- **单字移除/移动**：
  - 字集内单字支持"移除"（从当前字集删除）
  - 字集内单字支持"移动"（转移至其他字集）
  - 移除/移动按钮hover时变色（从默认灰→墨黑）
  - 移除后单字仅从当前字集删除，不影响其他字集

---

### 4. 作品提交与审核模块 📤

#### 功能点

- **作品图片上传**：
  - 支持单张/批量上传（单次最多5张）
  - 格式限制：JPG/PNG
  - 单张大小≤200MB
  - 上传时显示进度条（百分比）
  - 非支持格式/超大小实时提示
  - 上传图片分辨率≥1000px（长边），保证切片清晰度

- **格子手动调整**：
  - 系统自动分格后，用户可拖动格子边界调整位置/大小
  - 支持"重置为自动分格"功能
  - 调整时显示网格线（红色，透明度80%）
  - 调整后点击"确认分格"生效
  - 手动调整后的数据实时保存，刷新页面不丢失

- **信息录入**：
  - **作品信息**：
    - 名称（必填，限50字）
    - 作者（默认当前用户，可修改）
    - 风格（下拉选择：楷书/行书/草书/隶书/篆书）
    - 简介（可选，限500字）
  - **单字信息**：
    - 支持批量设置风格（默认继承作品风格）
    - 可单独修改每个字的风格
  - 信息不全时，"提交审核"按钮置灰并提示"请完善必填信息"

- **草稿保存/提交审核**：
  - 支持保存草稿（7天内有效，显示"草稿"标识）
  - 草稿列表显示"最后编辑时间"
  - 支持"继续编辑"/"删除草稿"
  - 草稿自动保存频率：每3分钟1次
  - 提交后进入"待审核"状态
  - 审核结果通过站内信通知

- **审核流转**：
  - 自动初筛（检测非书法内容/违规信息）
  - 人工复核（内容真实性/版权）
  - 结果通知（通过/驳回原因）
  - 审核时效≤24小时
  - 待审核作品显示"审核中"进度条
  - 初筛不通过：提示"内容不符合要求（如非书法作品）"
  - 复核不通过：提示具体原因（如"作者信息有误"）
  - 驳回作品支持"编辑后重新提交"

---

### 5. 分类检索模块 🔍

#### 功能点

- **全局关键词检索**：
  - 顶部检索框输入"作者/作品名称/风格"
  - 实时显示匹配结果（输入延迟≤500ms）
  - 支持"作品/单字/字集"类型切换
  - 检索结果按"匹配度（关键词位置）+ 热度（点赞量）"排序
  - 前3条高亮显示
  - 关键词支持部分匹配（如输入"王羲"，匹配"王羲之《兰亭集序》"）

- **多维度筛选**：
  - 作品列表页侧边栏提供筛选条件：
    - 风格（多选）
    - 作者（模糊输入）
    - 作品来源（单选：系统/用户）
  - 筛选条件可组合，选中状态用"墨黑对勾"标识
  - 筛选结果分页显示，每页20条
  - 支持快速返回顶部

- **个人字集检索**：
  - 个人中心内提供字集检索框
  - 支持按"字集名称/作者/风格"检索个人收藏的单字
  - 检索范围仅为当前用户创建的字集
  - 检索结果实时更新
  - 无匹配时显示"暂无匹配单字"

- **结果展示切换**：
  - 支持"列表模式"（显示单字+基础信息）
  - 支持"网格模式"（仅显示单字切片）
  - 切换按钮位于结果页顶部，点击实时切换视图
  - 记忆用户上次选择的模式
  - 列表模式单页显示30个单字
  - 网格模式单页显示40个单字

---

### 6. 个人中心模块 👤

#### 功能点

- **账号信息展示**：
  - 显示头像、用户名、绑定手机
  - 权限标识（普通用户/创作者（上传≥10篇通过作品））
  - 头像支持上传/裁剪（圆形，尺寸200×200px）
  - 用户名限10字，修改后30天内不可再次修改

- **内容管理**：
  - **我的作品**：
    - 按"待审核/通过/驳回"分类展示
    - 点击可查看审核进度
    - 驳回作品支持"编辑后重新提交"
    - 待审核作品最多显示10条，超出分页
  - **我的字集**：
    - 显示所有创建的字集及单字数量
    - 点击进入字集详情页
  - **草稿箱**：
    - 显示7天内未提交的草稿
    - 支持"继续编辑"/"删除草稿"
    - 超过7天自动删除

- **互动数据**：
  - 收到的赞（单字/作品被点赞数）
  - 收藏记录（所有收藏的单字列表）
  - 浏览历史（近30天浏览的作品，最多保存100条）
  - 互动数据实时更新
  - 点击可进入对应详情页

- **系统设置**：
  - 修改密码
  - 绑定手机
  - 隐私权限（作品可见范围：公开/仅自己可见）
  - 缓存清理（需二次确认，仅删除本地图片缓存）
  - 意见反馈
  - 隐私权限修改后实时生效

---

## 三、技术特点

### 前端技术
- **HTML5 + CSS3**：使用SCSS预处理（可选）
- **JavaScript**：原生JavaScript，支持现代浏览器
- **AJAX异步交互**：前后端数据交互
- **Canvas画布绘图**：用于作品缩放、拖拽、格子绘制
- **响应式设计**：适配不同屏幕尺寸

### 后端技术（参考）
- **框架**：Flask (Python)
- **数据库**：SQLite (SQLAlchemy ORM)
- **Session管理**：Flask Session
- **文件上传**：werkzeug

### 图像处理
- **自动分格算法**：基于OpenCV的图像处理
- **单字切片提取**：根据格子边界切割单字
- **图片缩放优化**：前端Canvas处理

---

## 四、数据库模型（参考）

项目需要使用以下数据表：

1. **User** - 用户表
   - 用户基本信息、权限标识

2. **Work** - 作品表
   - 作品信息、审核状态、上传时间

3. **Character** - 单字表
   - 单字切片、作者、风格、所属作品

4. **Collection** - 字集表
   - 字集名称、简介、创建时间

5. **UserCollection** - 用户字集关联表
   - 用户与字集的关联关系

6. **CollectionCharacter** - 字集单字关联表
   - 字集与单字的关联关系

7. **WorkDraft** - 草稿表
   - 草稿内容、最后编辑时间

8. **WorkReview** - 审核记录表
   - 审核状态、审核时间、审核意见

9. **UserLike** - 点赞表
   - 用户点赞记录

10. **BrowseHistory** - 浏览历史表
    - 用户浏览记录

---

## 五、文件存储结构

```
static/
├── upload_imgs/          # 用户上传的原始作品图片
├── work_images/           # 处理后的作品图片
├── character_slices/      # 单字切片图片
│   └── {work_id}/         # 按作品ID分组
├── user_avatars/          # 用户头像
├── draft_images/          # 草稿图片
├── css/                   # 样式文件
├── js/                    # JavaScript脚本
└── images/                # 静态图片资源
```

---

## 六、API接口列表（参考）

### 用户相关
- `POST /api/login` - 登录验证
- `POST /api/register` - 注册
- `POST /api/logout` - 退出登录
- `GET /api/user/info` - 获取用户信息
- `POST /api/user/avatar` - 上传头像
- `POST /api/user/password` - 修改密码
- `POST /api/user/phone` - 绑定手机

### 作品相关
- `GET /api/works` - 获取作品列表（支持分页、筛选、排序）
- `GET /api/works/<work_id>` - 获取作品详情
- `GET /api/works/<work_id>/characters` - 获取作品单字列表
- `POST /api/works/upload` - 上传作品
- `POST /api/works/<work_id>/update` - 更新作品信息
- `POST /api/works/<work_id>/submit` - 提交审核
- `DELETE /api/works/<work_id>` - 删除作品

### 单字相关
- `GET /api/characters/<character_id>` - 获取单字详情
- `POST /api/characters/<character_id>/like` - 点赞单字

### 字集相关
- `GET /api/collections` - 获取用户字集列表
- `POST /api/collections` - 创建字集
- `PUT /api/collections/<collection_id>` - 更新字集
- `DELETE /api/collections/<collection_id>` - 删除字集
- `GET /api/collections/<collection_id>/characters` - 获取字集内单字
- `POST /api/collections/<collection_id>/add` - 添加单字到字集
- `POST /api/collections/<collection_id>/remove` - 从字集移除单字
- `POST /api/collections/<collection_id>/move` - 移动单字到其他字集

### 检索相关
- `GET /api/search` - 全局检索（支持关键词、类型、筛选）
- `GET /api/search/works` - 检索作品
- `GET /api/search/characters` - 检索单字

### 草稿相关
- `GET /api/drafts` - 获取草稿列表
- `POST /api/drafts` - 保存草稿
- `PUT /api/drafts/<draft_id>` - 更新草稿
- `DELETE /api/drafts/<draft_id>` - 删除草稿

### 审核相关
- `GET /api/reviews` - 获取审核记录（用户查看自己的作品审核状态）
- `GET /api/reviews/<review_id>` - 获取审核详情

### 个人中心相关
- `GET /api/user/works` - 获取我的作品
- `GET /api/user/likes` - 获取收到的赞
- `GET /api/user/history` - 获取浏览历史
- `POST /api/user/settings` - 更新系统设置

---

## 七、功能流程图

### 作品上传流程
```
上传图片 → 系统自动分格 → 用户手动调整（可选）→ 
填写作品信息 → 填写单字信息 → 
选择操作（保存草稿/提交审核）→ 
审核流转（自动初筛→人工复核）→ 
结果通知（通过/驳回）→ 作品上线/重新编辑
```

### 单字收藏流程
```
浏览作品 → hover单字查看信息 → 
点击收藏按钮 → 选择字集（已有/新建）→ 
填写字集信息（新建时）→ 收藏成功 → 
可在"我的字集"查看
```

### 检索流程
```
输入关键词 → 实时匹配结果 → 
选择检索类型（作品/单字）→ 
应用筛选条件（风格/作者/来源）→ 
查看结果（列表/网格模式）→ 
点击进入详情页
```
---

## 八、页面功能对应表

| 页面 | 核心功能 | 交互要点 |
|------|---------|---------|
| **index.html** | 作品列表展示、全局检索入口 | 网格/列表切换、筛选、分页 |
| **work_detail.html** | 作品详情、单字hover、缩放拖拽 | 自动分格、弹窗交互、Canvas操作 |
| **work_upload.html** | 作品上传、分格调整、信息录入 | 文件上传、格子编辑、表单验证 |
| **search.html** | 全局检索、多维度筛选 | 实时搜索、结果切换 |
| **my_collections.html** | 字集管理、单字筛选 | 字集CRUD、单字操作 |
| **profile.html** | 个人中心、内容管理 | 多标签页、数据展示 |
| **login.html** | 用户登录 | 表单验证、错误提示 |
| **register.html** | 用户注册 | 表单验证、头像上传 |

---

## 九、开发优先级建议

### 第一阶段（MVP核心功能）
1. 用户认证系统（登录/注册）
2. 作品列表展示
3. 作品详情页（基础展示，暂不实现hover和缩放）
4. 作品上传（基础上传，暂不实现分格调整）

### 第二阶段（核心交互）
1. 作品自动分格功能
2. 单字hover弹窗
3. 作品缩放/拖拽
4. 单字收藏功能
5. 字集管理（创建、查看）

### 第三阶段（完善功能）
1. 格子手动调整
2. 多维度检索与筛选
3. 草稿保存功能
4. 个人中心完整功能
5. 审核状态查看